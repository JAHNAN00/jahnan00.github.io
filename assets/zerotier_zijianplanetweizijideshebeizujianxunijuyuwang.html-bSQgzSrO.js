import{_ as s,c as n,b as a,o as i}from"./app-BI8s6Rdr.js";const t="/assets/image-20251110023314046-Q5XUdt-Q.png",l="/assets/image-20251110024731078-dCsmD6Fa.png",p="/assets/image-20251110025108310-Bu_3Zgqf.png",r="/assets/image-20251110030705191-BYUoWqwb.png",c={};function d(o,e){return i(),n("div",null,[...e[0]||(e[0]=[a(`<h2 id="zerotier" tabindex="-1"><a class="header-anchor" href="#zerotier"><span>zerotier</span></a></h2><p>zerotier是一个基于P2P技术的用于搭建<strong>虚拟局域网</strong>的工具。</p><p>局域网为某个AP下的不同设备分配不同的IP，设备之间可以通过IP互相访问。例如一间房子里有一个路由器，所有连接到该路由器的设备组成了一个局域网。</p><p>但是，经常有访问不在同一局域网设备的需求。例如，你带着一台笔记本电脑去教室上课，但是想要访问你放在宿舍的服务器或者台式电脑。这时，一种方法是通过frp等手段搭建<strong>内网穿透</strong>，这种方法将内网的端口映射并暴露在公网中，从而可以使用远程服务，但是安全性稍差，且要求必须有公网IP。</p><p>虚拟局域网则是通过P2P技术，也就是俗称打洞。它不需要公网IP，且每个设备在虚拟局域网中的IP不变，就好像在同一个局域网中一样。缺点是，打洞能否成功经常需要取决于服务商等因素。</p><h2 id="安装zerotier客户端" tabindex="-1"><a class="header-anchor" href="#安装zerotier客户端"><span>安装zerotier客户端</span></a></h2><p>客户端安装方式如下。</p><h3 id="windows" tabindex="-1"><a class="header-anchor" href="#windows"><span>Windows</span></a></h3><p>在官网下载页（https://www.zerotier.com/download/）下载msi文件并安装。</p><p>安装后，默认配置文件位置：<code> C:\\ProgramData\\ZeroTier\\One</code></p><h3 id="macos" tabindex="-1"><a class="header-anchor" href="#macos"><span>MacOS</span></a></h3><p>在官网下载页（https://www.zerotier.com/download/）下载MacOS PKG Installer并安装。</p><p>安装后，默认配置文件位置：<code>/Library/Application Support/ZeroTier/One</code></p><h3 id="ubuntu" tabindex="-1"><a class="header-anchor" href="#ubuntu"><span>Ubuntu</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-s</span> https://install.zerotier.com <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">bash</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>安装后，配置文件目录在：<code>/var/lib/zerotier-one</code></p><h2 id="加入网络" tabindex="-1"><a class="header-anchor" href="#加入网络"><span>加入网络</span></a></h2><p>Windows和MacOS下，使用图形化界面即可。例：</p><p><img src="`+t+`" alt="image-20251110023314046"></p><p>Ubuntu（或者说Linux）下，需要使用命令行工具</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">zerotier-cli <span class="token function">join</span> <span class="token variable">$YOUR_NET_ID</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>$YOUR_NET_ID</code>是你的网络节点ID。</p><h2 id="配置网络节点" tabindex="-1"><a class="header-anchor" href="#配置网络节点"><span>配置网络节点</span></a></h2><p>如果你计划使用官方服务，请在官网（https://www.zerotier.com）注册账号和节点，并在Member选项卡中管理你的设备，绑定虚拟IP。绑定好并打洞成功后，可以试着能否Ping通。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">ping</span> <span class="token variable">$YOUR_VIRTUAL_IP</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果能ping通说明打洞成功了。</p><h2 id="自建planet服务器" tabindex="-1"><a class="header-anchor" href="#自建planet服务器"><span>自建planet服务器</span></a></h2><p>由于官方服务需要跨境访问，可能带来不好的体验，因此如果有服务器的话更推荐在服务器上自建一个服务端。一个planet服务器需要有一个UI界面，和一个分发给各设备的planet文件。</p><h3 id="在服务器上搭建ztncui" tabindex="-1"><a class="header-anchor" href="#在服务器上搭建ztncui"><span>在服务器上搭建ztncui</span></a></h3><p>主要参考https://key-networks.com/ztncui/#installation。</p><p>关键命令如下。</p><p>获取deb安装包</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-O</span> https://s3-us-west-1.amazonaws.com/key-networks/deb/ztncui/1/x86_64/ztncui_0.8.14_amd64.deb</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>使用apt安装</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ./ztncui_0.8.14_amd64.deb</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建<code>.env</code>文件</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;echo ZT_TOKEN=<span class="token variable"><span class="token variable">\`</span><span class="token function">sudo</span> <span class="token function">cat</span> /var/lib/zerotier-one/authtoken.secret<span class="token variable">\`</span></span> &gt; /opt/key-networks/ztncui/.env&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在<code>.env</code>文件中添加以下内容</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token assign-left variable">HTTPS_PORT</span><span class="token operator">=</span><span class="token number">3443</span></span>
<span class="line"><span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>production</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>更改权限</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">400</span> /opt/key-networks/ztncui/.env</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">chown</span> ztncui.ztncui /opt/key-networks/ztncui/.env</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>启动服务，以及检查服务状态</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> systemctl restart ztncui</span>
<span class="line"><span class="token function">sudo</span> systemctl status ztncui</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>服务启动后，就可以通过服务器的3443端口访问ztncui了。由于没有证书，浏览器可能会警告，这是正常的。</p><h3 id="ztncui的使用" tabindex="-1"><a class="header-anchor" href="#ztncui的使用"><span>ztncui的使用</span></a></h3><p>进入ztncui后点击右上角login。首次登录，用户名填<code>admin</code>，密码填<code>password</code>。</p><p><img src="`+l+'" alt="image-20251110024731078"></p><p>登录成功后，建议设置一个强度够高的新密码，因为这个页面是在公网里随时被扫的。创建好新用户后建议把原始的admin账户删除（或者至少改掉默认密码）。</p><p>然后在<code>Networks</code>一栏，跟随页面提示建立一个新的网络节点，自行分配虚拟网段。配置好后，记下NetworkID，设备加入网络就需要添加这个id。</p><p><img src="'+p+`" alt="image-20251110025108310"></p><h3 id="制作并分发planet文件" tabindex="-1"><a class="header-anchor" href="#制作并分发planet文件"><span>制作并分发planet文件</span></a></h3><p>制作planet文件首先需要写好moon配置，获得<code>moon.json</code>文件。</p><p>初始化moon配置文件</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token builtin class-name">cd</span> /var/lib/zerotier-one <span class="token comment"># 进入\`zerotier-one\`库目录</span></span>
<span class="line">zerotier-idtool initmoon identity.public <span class="token operator">&gt;&gt;</span> moon.json <span class="token comment"># 生成 json文件</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>编辑<code>moon.json</code>文件，在<code>stableEndpoints</code>下配置自己的公网IP以及端口，端口使用默认的<code>9993</code>即可。这样<code>moon.json</code>就写好了。</p><p>在https://github.com/kaaass/ZeroTierOne/releases下载可执行文件<code>mkmoonworld-x86_64</code>，然后执行</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">cp</span> /var/lib/zerotier-one/moon.json ./</span>
<span class="line">./mkmoonworld-x86_64 ./moon.json</span>
<span class="line"><span class="token function">mv</span> world.bin planet</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这就制作好planet文件了。</p><p>找到各个需要部署的客户端（目录见上），将原有的planet重命名进行备份</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 在各个客户端的对应目录内</span></span>
<span class="line"><span class="token function">mv</span> planet planet.old</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后将制作好的planet放到该目录下，代替原有的planet，并重启服务。</p><h3 id="重启服务并查找自己的服务器节点" tabindex="-1"><a class="header-anchor" href="#重启服务并查找自己的服务器节点"><span>重启服务并查找自己的服务器节点</span></a></h3><p>mac重启服务：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> launchctl unload /Library/LaunchDaemons/com.ZeroTier.one.plist</span>
<span class="line"><span class="token function">sudo</span> launchctl load /Library/LaunchDaemons/com.ZeroTier.one.plist</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>linux重启服务：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">systemctl restart zerotier-one.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>windows重启服务：</p><p>去服务页面里面找到对应服务，重启。</p><p>重启好以后，测试能否找到服务器</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">zerotier-cli listpeers</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果能看到自己的服务器ip就说明搭建成功了。</p><h3 id="设备加入节点" tabindex="-1"><a class="header-anchor" href="#设备加入节点"><span>设备加入节点</span></a></h3><p>根据服务器ztncui的节点ID，让自己的设备加入对应的网络。初次加入网络需要在后台ztncui中勾选<code>Authorized</code>进行许可。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">zerotier-cli <span class="token function">join</span> <span class="token variable">$YOUR_NET_ID</span> <span class="token comment">#有图形界面的使用图形界面</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果设备能在后台显示在线，并且互相能ping通，说明虚拟局域网搭好了。</p><p><img src="`+r+'" alt="image-20251110030705191"></p><p>至此，你的所有设备像是被加入了一个局域网，通过固定ip即可相互访问，也可以ssh或者远程桌面等。</p>',77)])])}const h=s(c,[["render",d]]),m=JSON.parse('{"path":"/blogs/useful_tools/zerotier_zijianplanetweizijideshebeizujianxunijuyuwang.html","title":"zerotier+自建planet为设备组建虚拟局域网","lang":"zh-CN","frontmatter":{"title":"zerotier+自建planet为设备组建虚拟局域网","date":"2025/02/06","tags":["Web","物联网","多设备"],"categories":["实用工具"]},"headers":[{"level":2,"title":"zerotier","slug":"zerotier","link":"#zerotier","children":[]},{"level":2,"title":"安装zerotier客户端","slug":"安装zerotier客户端","link":"#安装zerotier客户端","children":[{"level":3,"title":"Windows","slug":"windows","link":"#windows","children":[]},{"level":3,"title":"MacOS","slug":"macos","link":"#macos","children":[]},{"level":3,"title":"Ubuntu","slug":"ubuntu","link":"#ubuntu","children":[]}]},{"level":2,"title":"加入网络","slug":"加入网络","link":"#加入网络","children":[]},{"level":2,"title":"配置网络节点","slug":"配置网络节点","link":"#配置网络节点","children":[]},{"level":2,"title":"自建planet服务器","slug":"自建planet服务器","link":"#自建planet服务器","children":[{"level":3,"title":"在服务器上搭建ztncui","slug":"在服务器上搭建ztncui","link":"#在服务器上搭建ztncui","children":[]},{"level":3,"title":"ztncui的使用","slug":"ztncui的使用","link":"#ztncui的使用","children":[]},{"level":3,"title":"制作并分发planet文件","slug":"制作并分发planet文件","link":"#制作并分发planet文件","children":[]},{"level":3,"title":"重启服务并查找自己的服务器节点","slug":"重启服务并查找自己的服务器节点","link":"#重启服务并查找自己的服务器节点","children":[]},{"level":3,"title":"设备加入节点","slug":"设备加入节点","link":"#设备加入节点","children":[]}]}],"git":{"createdTime":1738692639000,"updatedTime":1762715338000,"contributors":[{"name":"JAHNAN00","email":"jahnan00@qq.com","commits":4}]},"filePathRelative":"blogs/useful_tools/zerotier_自建planet为自己的设备组建虚拟局域网.md"}');export{h as comp,m as data};
